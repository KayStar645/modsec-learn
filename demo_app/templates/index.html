<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ModSec Learn Demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <span class="navbar-brand">ModSecurity + Machine Learning Demo</span>
      </div>
    </nav>

    <main class="container py-4">
      <section class="mb-4">
        <h1 class="h3 mb-3">Gi·∫£ l·∫≠p cu·ªôc t·∫•n c√¥ng SQLi</h1>
        <p class="text-muted">
          S·ª≠ d·ª•ng c√°c tab b√™n d∆∞·ªõi ƒë·ªÉ th·ª≠ payload th·ªß c√¥ng, ch·∫°y batch h√†ng lo·∫°t v√† theo d√µi b√°o c√°o t·ªïng h·ª£p.
        </p>
      </section>

      <ul class="nav nav-tabs" id="mainTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="live-tab" data-bs-toggle="tab" data-bs-target="#tab-live" type="button" role="tab">
            Tr√¨nh di·ªÖn t·ª©c th·ªùi
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#tab-history" type="button" role="tab">
            Batch &amp; L·ªãch s·ª≠
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#tab-report" type="button" role="tab">
            B√°o c√°o m√¥ h√¨nh
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="rules-tab" data-bs-toggle="tab" data-bs-target="#tab-rules" type="button" role="tab">
            Tra c·ª©u Rules &amp; PL
          </button>
        </li>
      </ul>

      <div class="tab-content pt-3">
        <div class="tab-pane fade show active" id="tab-live" role="tabpanel" aria-labelledby="live-tab">
          <section class="card shadow-sm mb-4">
            <div class="card-body">
              <form id="payload-form">
                <div class="mb-3">
                  <label for="payload" class="form-label"
                    >Payload (v√≠ d·ª•: <code>' OR 1=1 --</code>)</label
                  >
                  <textarea
                    id="payload"
                    class="form-control"
                    rows="3"
                    required
                    placeholder="Nh·∫≠p payload..."
                  ></textarea>
                </div>

                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="pl-select" class="form-label">Paranoia Level</label>
                    <select id="pl-select" class="form-select"></select>
                  </div>
                  <div class="col-md-6">
                    <label for="model-select" class="form-label">M√¥ h√¨nh h·ªçc m√°y</label>
                    <select id="model-select" class="form-select">
                      <option value="">T·ª± ƒë·ªông ch·ªçn</option>
                    </select>
                  </div>
                </div>

                <div class="d-flex flex-wrap gap-2 mt-3">
                  <button type="submit" class="btn btn-primary">
                    Ph√¢n t√≠ch payload
                  </button>
                  <button type="button" class="btn btn-outline-secondary" data-demo="legit">
                    Payload h·ª£p l·ªá
                  </button>
                  <button type="button" class="btn btn-outline-danger" data-demo="sqli">
                    Payload SQLi m·∫´u
                  </button>
                  <button type="button" class="btn btn-outline-warning" data-demo="blind">
                    Blind SQLi
                  </button>
                </div>
              </form>
            </div>
          </section>

          <section class="card shadow-sm">
            <div class="card-body">
              <h2 class="h4 mb-3">K·∫øt qu·∫£ g·∫ßn nh·∫•t</h2>
              <div id="alert-area"></div>

              <div class="table-responsive">
                <table class="table table-striped align-middle" id="results-table">
                  <thead>
                    <tr>
                      <th>Th·ªùi gian</th>
                      <th>Payload</th>
                      <th>PL</th>
                      <th>ModSecurity</th>
                      <th>M√¥ h√¨nh ML</th>
                      <th>Rules</th>
                      <th>Chi ti·∫øt</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-history" role="tabpanel" aria-labelledby="history-tab">
          <section class="card shadow-sm mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-4">
                  <label for="dataset-select" class="form-label">Ngu·ªìn payload batch</label>
                  <select id="dataset-select" class="form-select"></select>
                  <div class="form-text" id="dataset-meta"></div>
                </div>
                <div class="col-md-3">
                  <label for="batch-size" class="form-label">S·ªë payload</label>
                  <input type="number" id="batch-size" class="form-control" value="20" min="1" max="500" />
                </div>
                <div class="col-md-3">
                  <label for="batch-pl-select" class="form-label">Paranoia Level</label>
                  <select id="batch-pl-select" class="form-select"></select>
                </div>
                <div class="col-md-2 d-grid">
                  <button type="button" id="batch-run-btn" class="btn btn-outline-primary">
                    Ch·∫°y batch
                  </button>
                </div>
                <div class="col-12">
                  <label class="form-label">Ch·ªçn m√¥ h√¨nh h·ªçc m√°y</label>
                  <div id="batch-model-checkboxes" class="model-checkboxes"></div>
                </div>
              </div>
            </div>
          </section>

          <section class="card shadow-sm mb-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h5 mb-0">T√≥m t·∫Øt batch g·∫ßn nh·∫•t</h2>
                <button class="btn btn-sm btn-outline-secondary" type="button" id="toggle-explanation-btn" style="display: none;">
                  <span id="explanation-toggle-text">Hi·ªÉn th·ªã gi·∫£i th√≠ch</span>
                </button>
              </div>
              <div id="batch-summary" class="alert alert-info d-none"></div>
              <div id="batch-explanation" class="mt-3 d-none">
                <div class="card border-primary">
                  <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">üìä Gi·∫£i th√≠ch chi ti·∫øt c√°c s·ªë li·ªáu</h6>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <div class="border rounded p-3 h-100">
                          <h6 class="text-primary mb-2">1. T·ªïng payload</h6>
                          <p class="small mb-2"><strong>ƒê·ªãnh nghƒ©a:</strong> T·ªïng s·ªë payload ƒë√£ ƒë∆∞·ª£c ph√¢n t√≠ch trong batch n√†y.</p>
                          <p class="small mb-0"><strong>V√≠ d·ª•:</strong> N·∫øu b·∫°n ch·ªçn dataset v·ªõi 20 payload, th√¨ t·ªïng payload = 20.</p>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="border rounded p-3 h-100">
                          <h6 class="text-danger mb-2">2. ModSecurity ch·∫∑n</h6>
                          <p class="small mb-2"><strong>ƒê·ªãnh nghƒ©a:</strong> S·ªë payload m√† ModSecurity quy·∫øt ƒë·ªãnh ch·∫∑n (decision = "block").</p>
                          <p class="small mb-0"><strong>ƒêi·ªÅu ki·ªán:</strong> Score >= 5.0 (threshold). ModSecurity t√≠nh ƒëi·ªÉm d·ª±a tr√™n rules k√≠ch ho·∫°t.</p>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="border rounded p-3 h-100">
                          <h6 class="text-warning mb-2">3. ML ƒë√°nh d·∫•u attack</h6>
                          <p class="small mb-2"><strong>ƒê·ªãnh nghƒ©a:</strong> S·ªë payload m√† m√¥ h√¨nh ML d·ª± ƒëo√°n l√† t·∫•n c√¥ng (prediction = 1).</p>
                          <p class="small mb-0"><strong>C√°ch ho·∫°t ƒë·ªông:</strong> ML ph√¢n t√≠ch feature vector t·ª´ rules k√≠ch ho·∫°t v√† ƒë∆∞a ra d·ª± ƒëo√°n.</p>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="border rounded p-3 h-100">
                          <h6 class="text-success mb-2">4. C√πng ch·∫∑n</h6>
                          <p class="small mb-2"><strong>ƒê·ªãnh nghƒ©a:</strong> S·ªë payload m√† C·∫¢ ModSecurity V√Ä ML ƒë·ªÅu ch·∫∑n/ƒë√°nh d·∫•u l√† t·∫•n c√¥ng.</p>
                          <p class="small mb-0"><strong>√ù nghƒ©a:</strong> ƒê·ªô tin c·∫≠y cao v√¨ c·∫£ hai h·ªá th·ªëng ƒë·ªìng √Ω.</p>
                        </div>
                      </div>
                    </div>
                    <div class="alert alert-light mt-3 mb-0">
                      <h6 class="mb-2">üìà Ph√¢n t√≠ch k·∫øt qu·∫£:</h6>
                      <div id="batch-analysis" class="small"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="card shadow-sm mb-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <h2 class="h5 mb-0">L·ªãch s·ª≠ (log)</h2>
                <div class="d-flex align-items-center gap-2">
                  <input type="number" id="log-limit" class="form-control form-control-sm" style="width: 110px" value="50" min="10" max="500" />
                  <button class="btn btn-sm btn-outline-secondary" id="reload-logs-btn">T·∫£i l·∫°i log</button>
                </div>
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle" id="logs-table">
                  <thead>
                    <tr>
                      <th>Th·ªùi gian</th>
                      <th>Payload</th>
                      <th>PL</th>
                      <th>ModSecurity</th>
                      <th>Rules</th>
                      <th>ML</th>
                      <th>Ngu·ªìn</th>
                      <th>Chi ti·∫øt</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div class="d-flex justify-content-between align-items-center mt-2">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-secondary" id="log-prev-btn">Trang tr∆∞·ªõc</button>
                  <span class="mx-2 text-muted small" id="log-page-info">Trang 1/1</span>
                  <button class="btn btn-outline-secondary" id="log-next-btn">Trang sau</button>
                </div>
              </div>
              <div class="text-muted small mt-2" id="log-meta"></div>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-report" role="tabpanel" aria-labelledby="report-tab">
          <section class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <div>
                  <h2 class="h5 mb-1">B√°o c√°o hi·ªáu nƒÉng m√¥ h√¨nh</h2>
                  <p class="text-muted mb-0">D·ª±a tr√™n log g·∫ßn nh·∫•t (c√≥ th·ªÉ t·∫£i th√™m ƒë·ªÉ c·∫≠p nh·∫≠t th·ªëng k√™).</p>
                </div>
                <button class="btn btn-sm btn-outline-primary" id="refresh-stats-btn">L√†m m·ªõi bi·ªÉu ƒë·ªì</button>
              </div>
              <div class="row g-4">
                <div class="col-lg-6">
                  <canvas id="chart-attack-rate" height="220"></canvas>
                </div>
                <div class="col-lg-6">
                  <canvas id="chart-agreement" height="220"></canvas>
                </div>
              </div>
              <div class="text-muted small mt-3" id="stats-meta"></div>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-rules" role="tabpanel" aria-labelledby="rules-tab">
          <section class="card shadow-sm mb-4">
            <div class="card-body">
              <h2 class="h4 mb-3">Paranoia Level (PL) - M·ª©c ƒë·ªô nh·∫°y c·∫£m</h2>
              <div class="row g-3">
                <div class="col-md-6 col-lg-3">
                  <div class="card border-primary h-100">
                    <div class="card-body">
                      <h5 class="card-title text-primary">PL 1</h5>
                      <p class="card-text small mb-2"><strong>M·ª©c m·∫∑c ƒë·ªãnh</strong></p>
                      <ul class="small mb-0 ps-3">
                        <li>√çt nh·∫°y nh·∫•t</li>
                        <li>√çt false positive</li>
                        <li>Ph√π h·ª£p production</li>
                        <li>Ch·ªâ k√≠ch ho·∫°t rules c∆° b·∫£n</li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-lg-3">
                  <div class="card border-warning h-100">
                    <div class="card-body">
                      <h5 class="card-title text-warning">PL 2</h5>
                      <p class="card-text small mb-2"><strong>TƒÉng ƒë·ªô nh·∫°y</strong></p>
                      <ul class="small mb-0 ps-3">
                        <li>B·∫Øt th√™m m·ªôt s·ªë t·∫•n c√¥ng</li>
                        <li>C√≥ m·ªôt s·ªë false positive</li>
                        <li>Ph√π h·ª£p moderate security</li>
                        <li>K√≠ch ho·∫°t th√™m rules</li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-lg-3">
                  <div class="card border-danger h-100">
                    <div class="card-body">
                      <h5 class="card-title text-danger">PL 3</h5>
                      <p class="card-text small mb-2"><strong>R·∫•t nh·∫°y</strong></p>
                      <ul class="small mb-0 ps-3">
                        <li>B·∫Øt nhi·ªÅu t·∫•n c√¥ng h∆°n</li>
                        <li>Nhi·ªÅu false positive</li>
                        <li>C·∫ßn tuning k·ªπ</li>
                        <li>K√≠ch ho·∫°t nhi·ªÅu rules</li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-lg-3">
                  <div class="card border-dark h-100">
                    <div class="card-body">
                      <h5 class="card-title text-dark">PL 4</h5>
                      <p class="card-text small mb-2"><strong>C·ª±c k·ª≥ nh·∫°y</strong></p>
                      <ul class="small mb-0 ps-3">
                        <li>B·∫Øt h·∫ßu h·∫øt t·∫•n c√¥ng</li>
                        <li>R·∫•t nhi·ªÅu false positive</li>
                        <li>Ch·ªâ d√πng khi c·∫ßn thi·∫øt</li>
                        <li>K√≠ch ho·∫°t t·∫•t c·∫£ rules</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="alert alert-info mt-3 mb-0">
                <strong>L∆∞u √Ω:</strong> PL cao h∆°n = Nhi·ªÅu rules k√≠ch ho·∫°t h∆°n = Nhi·ªÅu ƒëi·ªÉm h∆°n = Ph√°t hi·ªán nhi·ªÅu t·∫•n c√¥ng h∆°n (nh∆∞ng c≈©ng c√≥ nhi·ªÅu false positive h∆°n).
              </div>
            </div>
          </section>

          <section class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <h2 class="h4 mb-0">Tra c·ª©u Rules</h2>
                <div class="d-flex gap-2 flex-wrap">
                  <input
                    type="text"
                    id="rule-search"
                    class="form-control"
                    style="width: 250px"
                    placeholder="T√¨m ki·∫øm rule ID ho·∫∑c m√¥ t·∫£..."
                  />
                  <select id="rule-pl-filter" class="form-select" style="width: 150px">
                    <option value="">T·∫•t c·∫£ PL</option>
                    <option value="1">PL 1</option>
                    <option value="2">PL 2</option>
                    <option value="3">PL 3</option>
                    <option value="4">PL 4</option>
                  </select>
                </div>
              </div>
              <div id="rules-list" class="row g-3"></div>
              <div id="rules-empty" class="text-center text-muted py-4 d-none">
                Kh√¥ng t√¨m th·∫•y rule n√†o ph√π h·ª£p.
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailModalLabel">S∆° ƒë·ªì x·ª≠ l√Ω</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="detail-metadata" class="mb-3"></div>
            <div id="detail-timeline" class="timeline"></div>
            <div id="detail-rules" class="mt-3"></div>
            <div id="detail-models" class="mt-3"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>

